SELECT A.matricula, A.nome, AVG(AL.nota) AS media, AV.iddisciplina
FROM (Avaliacaodealuno AL INNER JOIN Alunos A ON AL.matriculaaluno = A.matricula) 
	  NATURAL INNER JOIN avaliacoes AV
GROUP BY A.matricula, A.nome, AV.iddisciplina ORDER BY A.nome


--Experimental

CREATE FUNCTION verificarAprovacao()
 RETURNS TRIGGER AS
 $$
 DECLARE
 	-- Declaração de uma variável do tipo de linha correspondente ao resultado da consulta
    aluno_row Alunos%ROWTYPE;

    -- Outras variáveis, se necessário
    media_notas NUMERIC;
BEGIN
    SELECT A.* INTO aluno_row
    FROM Alunos A
    INNER JOIN Avaliacaodealuno AL ON A.matricula = AL.matriculaaluno
    INNER JOIN avaliacoes AV ON AL.idavaliacao = AV.id
    WHERE A.matricula = NEW.matricula;
    SELECT AVG(AL.nota) INTO media_notas
    FROM Avaliacaodealuno AL
    WHERE AL.matriculaaluno = aluno_row.matricula;
END;
 $$
 LANGUAGE PLPGSQL